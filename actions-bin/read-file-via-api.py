import sys
import os
import requests
import base64

g_api_key = os.environ["G_READ_API_KEY"]
repo = sys.argv[1]
filename = sys.argv[2]

base_url = "https://api.github.com/repos/CVEProject/cve-reference-ingest/contents/"
path_ending = f"last_run_shas/{repo}/{filename}"
full_get_url = base_url + path_ending

headers = {
    "Accept": "application/vnd.github+json",
    "X-GitHub-Api-Version": "2022-11-28",
    "Authorization": f"Bearer {g_api_key}",
}

response = requests.get(full_get_url, headers=headers)
status_code = response.status_code

if status_code != 200:
    sys.stderr.write("failed to retrieve " + path_ending + " via API: " + str(status_code))
    exit()

json_response = response.json()
content = json_response.get("content")

sha = base64.b64decode(content + "\n")

print(sha)
